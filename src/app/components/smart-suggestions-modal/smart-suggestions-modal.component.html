<ion-header>
  <ion-toolbar>
    <ion-title>üí° Sugest√µes Inteligentes</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="suggestions-container">
    @if (suggestions().length === 0) {
      <!-- Vazio -->
      <div class="empty-state">
        <ion-icon name="bulb-outline" color="medium"></ion-icon>
        <h2>Nenhuma sugest√£o no momento</h2>
        <p>Continue usando o app e receber√° sugest√µes personalizadas para melhorar sua ades√£o!</p>
      </div>
    } @else {
      <!-- Lista de sugest√µes -->
      @for (suggestion of suggestions(); track suggestion.id) {
        <ion-card [class]="'suggestion-card priority-' + suggestion.priority">
          <ion-card-header>
            <div class="card-header-content">
              <ion-icon 
                [name]="getIconForType(suggestion.type)" 
                [color]="getColorForPriority(suggestion.priority)"
                class="suggestion-icon"
              ></ion-icon>
              <div class="header-text">
                <ion-card-title>{{ suggestion.title }}</ion-card-title>
                <ion-badge [color]="getColorForPriority(suggestion.priority)" class="priority-badge">
                  {{ suggestion.priority === 'high' ? 'Alta' : suggestion.priority === 'medium' ? 'M√©dia' : 'Baixa' }}
                </ion-badge>
              </div>
            </div>
          </ion-card-header>

          <ion-card-content>
            <!-- Descri√ß√£o -->
            <p class="description">{{ suggestion.description }}</p>

            <!-- An√°lise de dados -->
            <div class="analysis-section">
              <h3>üìä An√°lise de Dados</h3>
              <div class="analysis-stats">
                <div class="stat">
                  <span class="stat-label">Total de doses:</span>
                  <span class="stat-value">{{ suggestion.analysis.totalDoses }}</span>
                </div>
                <div class="stat">
                  <span class="stat-label">Doses perdidas:</span>
                  <span class="stat-value danger">{{ suggestion.analysis.missedDoses }}</span>
                </div>
                <div class="stat">
                  <span class="stat-label">Taxa de ades√£o:</span>
                  <span class="stat-value" [class.success]="suggestion.analysis.missedPercentage < 20">
                    {{ formatPercentage(100 - suggestion.analysis.missedPercentage) }}
                  </span>
                </div>
                @if (suggestion.analysis.averageDelayMinutes > 0) {
                  <div class="stat">
                    <span class="stat-label">Atraso m√©dio:</span>
                    <span class="stat-value warning">
                      {{ formatMinutes(suggestion.analysis.averageDelayMinutes) }}
                    </span>
                  </div>
                }
              </div>
            </div>

            <!-- A√ß√£o sugerida -->
            @if (suggestion.suggestedAction) {
              <div class="action-section">
                <h3>‚ú® A√ß√£o Sugerida</h3>
                @if (suggestion.suggestedAction.type === 'change-time') {
                  <div class="action-detail">
                    <ion-icon name="time-outline" color="primary"></ion-icon>
                    <span>
                      Mudar hor√°rio de <strong>{{ suggestion.analysis.scheduledTime }}</strong> 
                      para <strong>{{ suggestion.suggestedAction.newTime }}</strong>
                    </span>
                  </div>
                }
                @if (suggestion.suggestedAction.type === 'increase-reminders') {
                  <div class="action-detail">
                    <ion-icon name="notifications-outline" color="primary"></ion-icon>
                    <span>
                      Adicionar lembrete extra 
                      <strong>{{ suggestion.suggestedAction.reminderMinutesBefore }} minutos antes</strong>
                    </span>
                  </div>
                }
                @if (suggestion.suggestedAction.type === 'change-day') {
                  <div class="action-detail">
                    <ion-icon name="calendar-outline" color="primary"></ion-icon>
                    <span>Considere ajustar o dia da semana desta dose</span>
                  </div>
                }
              </div>
            }

            <!-- Bot√µes de a√ß√£o -->
            <div class="action-buttons">
              @if (suggestion.type !== 'praise') {
                <ion-button 
                  expand="block" 
                  color="success" 
                  (click)="acceptSuggestion(suggestion)"
                >
                  <ion-icon name="checkmark" slot="start"></ion-icon>
                  Aceitar Sugest√£o
                </ion-button>
                <ion-button 
                  expand="block" 
                  fill="outline" 
                  color="medium" 
                  (click)="rejectSuggestion(suggestion)"
                >
                  <ion-icon name="close-circle" slot="start"></ion-icon>
                  N√£o, obrigado
                </ion-button>
              } @else {
                <ion-button 
                  expand="block" 
                  color="primary" 
                  (click)="dismissSuggestion(suggestion)"
                >
                  <ion-icon name="checkmark" slot="start"></ion-icon>
                  Entendi!
                </ion-button>
              }
            </div>

            <!-- Confian√ßa da sugest√£o -->
            @if (suggestion.analysis.confidence > 0) {
              <ion-note class="confidence-note">
                Confian√ßa: {{ formatPercentage(suggestion.analysis.confidence * 100) }}
              </ion-note>
            }
          </ion-card-content>
        </ion-card>
      }
    }
  </div>
</ion-content>
